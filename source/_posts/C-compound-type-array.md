---
title: C/C++ compound type array
date: 2019-11-13 14:09:40
tags:
 - 数组
 - array
 - 指针
 - C/C++
categories: C/C++
---


## 数组
数组和`vector`类似，但是数组是定长的，大小不变，而`vector`是可变的，可以把`vector`看成可变长度的数组。
如果不清楚元素的确切个数，使用vector。

## 定义和初始化
数组的维度必须是确定的，在编译时就知道，即是一个常量表达式（值不会改变并且在编译时就已知）。
默认情况下，数组的元素被默认初始化。和内置类型的变量一样，如果在数组内部定义了某种内置类型的数组，那么默认初始化得到的数组含有未定义的值。
### 显式的初始化数组
1. 可以忽略维度，编译器会根据初始值推测出来；
2. 如果指明维度，初始值的数量不应该超出指定的大小；
3. 如果维度比提供的初始值大，其它的元素被初始化成默认值（值初始化）。

### 字符数组
1. 使用字符串字面值初始化。``` c
char str1[] = "helloworld";
//编译器会隐式的在最后加一个"\0"，sizeof(str)会计算这个"\0", strlen(str)不会
```
2. 使用列表初始化。```c
char str2[] = {'h', 'e', 'l', 'l', 'o'};
char str3[] = {'h', 'e', 'l', 'l', 'o', '\0'};
```

### 数组不支持直接拷贝和直接赋值
1. 不支持数组的拷贝是为了避免不必要的复制开销，数组复制将会导致连续的内存读和写。
2. 为什么用指针代替数组，不是因为他们太像了，而是避免赋值的开销，因为c里面只有值传递，如果对数组采用pass by value，会有很大的开销。

### 数组的指针和数组的引用
对于数组来说，采用从内向外的方式，即名数组名字开始，然后向左看数组类型，向右看数组大小。```c
int *ptrs[10]; //ptr是一个数组，数组的类型是int*的，大小是10
int (*ptr_array)[10]; //ptr_array是一个指针，指针指向一个大小为10的数组，数组的类型是int
int (&ref_array)[10]; //ref_array是一个引用，绑定到一个大小为10的数组，数组的类型是int
```

## 访问数组元素
使用范围for语句或者下标`[]`运算符，使用数组下标的时候，通常定义为无符号的`size_t`类型。


## 指针和数组
1. 指针和数组的联系很紧密，使用数组的时候编译器一般会把它转换成指针。
2. 使用取地址符获取某个对象的指针，对数组元素使用取地址符就能得到指向该元素的指针。
3. 在很多用到数组名字的时候，编译器都会自动的将它转换成一个指向数组首元素的指针。
4. 使用`auto`分析数组类型时会推断出指针类型，而使用`decltype`会推断出数组类型。

## 多维数组

## 参考文献
1.《C++ Primer第五版》
