---
title: C and C++ lvalue and rvalue
date: 2019-11-14 17:22:02
tags:
 - 左值
 - 右值
 - C/C++
categories: C/C++
---

## C语言中的lvalue和rvalue

### 左值和右值的定义
早期C给出的定义：
左值是一个表达式，可以出现在赋值操作的左边或者右边，而右值只能出现在左边。
给出一个更容易理解的定义：
左值是一个表达式，它表示一个可以被识别的变量或者对象在内存中的位置，并且允许使用取值地址符`&`获取这块内存的地址，如果一个表达式不是左值，那么它就被定义为右值。
或者说
左值是一个指定某个对象的表达式。

### 可修改左值
1. 左值指向的位置的内容，如果可以被修改，那么这个左值是一个可修改左值，否则就是不可修改左值。
2. 可修改左值指的是指向一个内存中的位置，并且它的类型是算术类型，`struct`，`union`或者pointer的表达式。
3. 可修改左值不能含有数组类型，不完整的类型，`const`修饰的类型，都是不可修改左值。如果`struct`或者`union`要是可修改左值，那么它们不能有`const`成员。
4. 为什么左值不能是`array`，我们不能对数组赋值，但是可以通过下标操作对数组进行赋值，所以数组名字不能是一个可修改的左值。或者说数组名字其实是数组首元素的地址。这里的数组赋值说的是：```c
int a[] = {1, 2, 3};
int b[] = {4, 5, 6};
b = a;  //想要做的操作是把数组a赋值给数组b，这是错误的。
```
5. 为什么没有说函数不能是可修改左值，函数名指定的是一个函数不是一个对象，所以函数名不能是左值，自然也不能是一个可修改左值。

### 左值
C语言中的左值有以下七种：
1. 任意类型变量的名字
2. 下标运算符`[]`
3. 带括号的左值表达式
4. 指针的成员访问操作`->`和`.`
5. 单目运算符解引用`*`的表达式，不能指向一个数组
6. 通过指针的解引用操作，不能是一个函数指针
7. `const`对象，是一个不可修改左值，比如`const int a = 0;`，`a`是一个不可修改左值

### 左值和右值的转换
一般情况下，对象之间的运算，对象是以右值的形式参与的。比如`+`运算符需要两个右值运算数：```
int a = 1;
int b = 2;
int c = a+b;
```
在上面的例子中,`a`和`b`都是左值，在`int c = a+b;`中，它们经历了隐式的类型转换，将左值转换为了右值。
除了数组，函数，不完整的类型，所有的左值都可以和转换为右值，但是右值不能转换为左值。

#### 右值产生左值
``` c
int a[] = {1, 2, 3};
int *p = &a[0];
*(p+1) = -1;    //p+1是右值，但是*(p+1)是左值
```

#### 左值产生右值
``` c
int var = 10;
int *p = &var;  //var是左值，但是&var是右值。
```
单目运算符`&`需要一个左值作为它的运算对象，当且仅当`n`是一个变量时，`&n`是一个有效的表达式，`&12`是错误的。


## C++中的lvalue和rvalue
当一个对象被用作右值的时候，用的是对象的值。当一个对象被用作左值的时候，用的是对象在内存中的位置。《C++ Primer》中说C++和C中的左值和右值不一样，我怎么觉得都一样呢。

### 示例
1. 赋值运算需要一个非常量左值作为左侧运算对象，得到的结果也仍然是一个左值。
2. 取地址符用作一个左值运算对象，返回一个指向该运算对象的地址，这个值是一个右值。
3. 内置解引用运算符，下标运算符，迭代器解引用运算符，`string`和`vector`的求值结果都是左值。
4. 内置类型和迭代器的递增递运算符作用于左值运算对象，其前置版本所得的结果也是左值，即`++iter`, `++i`等。

## 参考文献
1.《C和指针》
2.《C++ Primer》
3.https://www.geeksforgeeks.org/lvalue-and-rvalue-in-c-language/
4.https://segmentfault.com/a/1190000003793498
5.https://stackoverflow.com/questions/45656162/why-cant-a-modifiable-lvalue-have-an-array-type
5.https://www.quora.com/What-is-lvalue-and-rvalue-in-C
6.https://www.internalpointers.com/post/understanding-meaning-lvalues-and-rvalues-c
6.https://eli.thegreenplace.net/2011/12/15/understanding-lvalues-and-rvalues-in-c-and-c
